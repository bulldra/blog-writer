-   [x] Reasoning を最終プロンプト同様に折りたたみ表示に対応
-   [x] UI コンポーネントを分割（Collapsible 導入）
-   [x] 生成結果は単一プレビューに統一し、ソース（Markdown）は折りたたみで表示
-   [x] Collapsible にプレビューを追加（閉時にプレビュー表示）
-   [x] 最終プロンプト・Reasoning・ソースにプレビュー適用
-   [x] プレビュー行数を 3 行に調整（末尾表示は必要箇所のみ）
-   [x] 最終プロンプトは最終行ではなく最初の行
-   [x] リーズニングのスクロールは展開時にも同期
-   [x] 記事テンプレート「選択しない」を廃止。初回は先頭自動選択、選択は localStorage に保存
-   [x] ソースコードのスクロールはプレビュー位置に同期
-   [x] reasoning の展開時は markdown のマークアップを適用、展開前はプレーンテキスト
-   [x] reasoning の折りたたみ時の縦幅を自動調整せずに固定（72px）
-   [x] 最終プロンプトは prompt へ
-   [x] prompt の展開時は markdown のマークアップを適用、展開前はプレーンテキスト
-   [x] 記事テンプレートの選択をコンポーネント化
-   [x] コンポーネントの番号づけをを廃止
-   [x] 編集依頼のコンポーネントを切り出し
-   [x] 記事生成の追加指示は TODO リストで管理するシステムとする
-   [x] 「TODO で生成」ボタンを追加（既存の生成と同ハンドラで実行）
-   [x] プロパティ入力 → プランニング（AI）→ プラン修正 → プラン実行（AI）→ 記事生成（AI）
-   [x] プラン実行時に AI が TODO の生成と準拠を確認してリストを更新
-   [x] プラン自体は編集しない
-   [x] TODO リストの各項目に完了チェックボックスを追加
-   [x] TODO は plan の下側に自動生成
-   [x] 追加の指示（任意・固定化しません）は削除
-   [x] TODO は完了チェックボックスを追加し、完了したら打ち消し線を引く
-   [x] TODO は人間が自由に更新可能
-   [x] TODO の更新を人間がして生成を依頼することで記事を完成に近づける
-   [x] TODO を元にプロンプトを生成する
-   [x] UI のコンポーネント化をさらに推進
-   [x] 横幅を固定せずにレスポンシブ対応
-   [x] Kindle ウィジェットの構成変更: 書籍選択時に全ハイライトを取り込み対象とすることを明確化
-   [x] テンプレート削除ボタンはテンプレート名の左側に配置
-   [x] 変数名はタイトルの右側に置いて、縦幅を節約
-   [x] ウィジットに基づく提案中はローディング中であることをを分かるようにする
-   [x] ウィジットに基づく提案中は、ウィジットの選択をブロックする
-   [x] 変数名をクリックしたときに、変数名を挿入する
-   [x] test コードを test 配下の適切なサブディレクトリに移動
-   [x] 記事のメタデータやカスタムフィールドを設定します の説明は不要
-   [x] テストコードを整理、共通化
-   [x] テストコードのカバレッジを向上
-   [x] テストコードのカバレッジを測定する仕組みを導入
-   [x] プロパティセットには日付入力と選択肢入力を追加
-   [x] ウィジットに基づく提案はストリーミングで反映
-   [x] いい回しと辞書のサイドバー削除
-   [x] component への分割、整理、共通化リファクタリング
-   [x] 不要コードを削除
-   [x] pytest 実行
-   [x] selenium と chrome driver でスクレイピングするウィジェット（通常のスクレイピングと分けて管理）
-   [x] ruff, mypy, black 実行
-   [x] tasks.md 更新
-   [x] pytest では LLM をモック化（autouse fixture で app.ai_utils / app.routers.ai をスタブ）
-   [x] writer 画面でのウィジェット管理や編集は不要
-   [x] writer 画面でのプロパティ、例えば書籍タイトルはなどはプロパティセットで設定するので不要
-   [x] writer 画面でのウィジェットは記事生成のための情報収集に使うので、plan の前に配置
-   [x] selenium でスクリーンショットを撮って入力に使うウィジェット - バックエンド: Gemini 経路へ画像添付対応 - routers/ai: ウィジェット処理の返却を (text, media) に拡張し、genai_types.Blob で画像を添付 - LM Studio 経路は従来どおりテキストのみ - UI プレビューとフロントからの指定（mode: screenshot/both）は現状反映済み
-   [x] 追加可能なウィジェットについて一覧するのではなくコンボボックスで選択できるようにする
-   [x] テンプレート管理ページで未使用ウィジェットを select から選択 → 追加
-   [x] 既存のドラッグ&ドロップ順序入替は維持
-   [x] 記事テンプレート管理画面は最初に一覧のみ表示して、選択したら詳細画面に遷移する
-   [x] 一覧画面では表形式で情報を表示し、編集・削除ボタンを配置
-   [x] 詳細画面に一覧用の説明文フィールドを追加
-   [x] 一覧画面の説明文は折りたたみ表示
-   [x] テンプレートの複製機能を追加
-   [x] テンプレート一覧に検索・ソートを追加
-   [x] テンプレート一覧のウィジェット表示をタグ化
-   [x] スクリーンショット画像の UI プレビューを追加（writer/AI の入出力）
-   [x] 詳細画面で説明文の AI 提案（自動入力）を追加
-   [x] テンプレート一覧の編集リンクは不要で、行クリックで詳細画面に遷移
-   [x] obsidian パスと epub パスをファイル選択ダイアログで選択可能に
-   [x] mcp 設定は独立した画面で管理
-   [x] テンプレート一覧の説明文は折りたたみ表示不要
-   [x] テンプレート一覧ではマウスオーバーでハイライトする
-   [x] テンプレート一覧の説明文は 1 行に制限し、...で省略
-   [x] 複製は一覧ではなく詳細画面に配置

-   [x] 画像生成機能をオミットする
-   [x] 追加機能を提案
-   [x] AI でプロンプト雛形を提案するボタンはテンプレートを提案する機能に変更。ウィジェットも含めて提案するようにプロンプトを作成して実行
-   [x] 上書き保存と複製保存ボタンを下側につけて上側の複製ボタンを削除
-   [x] 説明文を AI で提案するボタンは削除
-   [x] プロパティセットをウェジェットを削除し、テキストウィジットに置き換え
-   [x] ウィジェットは同じ種類でも複数追加可能
-   [x] 計画モード、発想モード、実行モード、整理モード、学習モードをテンプレートで管理
-   [x] 選択ウィジェットで文体を切り替え
-   [x] 記事テンプレートのインポート/エクスポート（JSON）
-   [x] テンプレートのバージョン管理（履歴・差分表示）
-   [x] ウィジェットのサンドボックス実行（単体プレビュー）
-   [x] テンプレートの静的検証（必須変数未使用の警告など）
-   [x] Readme.md の更新
-   [x] X 取り込みウィジェット（最小） 
- [x] バックエンド: `x` をウィジェット一覧に追加 - [x] バックエンド: `/api/widgets/x/preview` 実装（raw_posts 入力 → 整形） - [x] テスト: ユニット/API テスト追加 - [x] フロント: テンプレート編集ページに X プレビュー UI を追加（raw_posts 入力） - [x] フロント: サンプル挿入/クリアボタン、ヘルプ文を追加 - [ ] 後続: 実データ取得（URL/認証/キャッシュ） - [x] フロント: X プレビュー UI に URL 入力欄（任意・現状未使用）を追加
-   [] コード整理 - [x] deprecated "properties" ウィジェットの完全削除（backend/API/tests/UI 整合）
-   [x] ドキュメント更新 - [x] tasks.md を更新（properties ウィジェット削除の完了を反映）
-   [] コード品質チェック
-   [] スタイルは CSS に分離

---

注意: Next.js 14 の開発は Node 18/20 推奨です。nvm などで Node 20 LTS に切り替えてください。

推奨手順（zsh, nvm 使用時）:

1. nvm で Node 20 LTS をインストール（未導入の場合） - nvm の導入: https://github.com/nvm-sh/nvm
2. Node 20 をインストール／切替 - インストール: `nvm install 20` - プロジェクトで使用: `nvm use 20` - デフォルト設定（任意）: `nvm alias default 20`

備考:

-   Node 22 では Next.js 14 の dev 実行で webpack ランタイムの欠損モジュールに遭遇する既知事象あり。
-   本プロジェクトの dev スクリプトでも Node 20 LTS 切替を推奨しています。
